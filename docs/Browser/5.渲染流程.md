---
title: 5.渲染流程
date: 2020-05-27
---

## 前言 

HTML渲染问题是一个面试基本上都会提及的问题，可有些人只能回答零星半点（说的就是真正看这篇文章的你😁）。这个问题也恰好是浏览器内部流程中一个非常重要的知识点，不讲不行，那么上篇文字讲到提交文档后，就要准备渲染了，那浏览器如何渲染呢？

## 三把斧🪓

作为前端工程狮，你不得不学会这三把斧：

+ **HTML**：超文本标记语言，是一种标记语言。它包括一系列标签．通过这些标签可以将网络上的文档格式统一，使分散的Internet资源连接为一个逻辑整体。  

通俗：你的身体结构。

+ **CSS**：层叠样式表是一种用来表现HTML（标准通用标记语言的一个应用）或XML（标准通用标记语言的一个子集）等文件样式的计算机语言。  

通俗：你身上穿的衣服。

+ **JS**：是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。  

通俗：你的行为动作。 

<br />

你看，多么简洁的概念啊，可这三个像形成结界一样困扰了绝大部分程序猿（媛），当然包括我🐶，不过这三个概念我相信你们已经理解，且会用（永远不要说精通，那都是骗人的）。

## 机制

渲染机制复杂难懂，所以渲染模块在执⾏过程中通常会有多个阶段，每个阶段处理的内容是不一样的，得按顺序依次进行，最后输出像素。如下图所示：

<img :src="$withBase('/image/渲染队列.png')" alt="渲染队列"/>


别被这么多阶段吓到了，其实仔细观察就会发现，这么多内容归纳在一起就是三部：**输入->处理->输出**

## 过程

1. **DOM树的构建**   

  <img :src="$withBase('/image/DOM树.png')" alt="DOM树"/>   

其实浏览器是无法直接使用HTML的，他需要被浏览器的**HTML解析器**转化为AST语法树🌲，这棵树，我们叫**DOM树**，有兴趣可以看看这篇文章👉[从Chrome源码看浏览器如何构建DOM树](https://zhuanlan.zhihu.com/p/24911872)

2. **样式计算**   

<img :src="$withBase('/image/CSSOM.png')" alt="CSSOM" height="400"/>   

我们在HTML引入的外部样式CSS文件，或者在HTML中写的内部样式Style代码块，还有标签上的行内样式。同HTML一样，也有个专门的CSS解析器负责解析成为**styleSheets**。

+ 渲染引擎会把获取到的CSS⽂本全部转换为**styleSheets**结构，该结构有查询和修改css的功能。

+ 在解析的过程中会进行值转化。值转化就是将css某些单位（em，rem，vh等）转化为px。如下：

```css
body{
    font-size:2em; // => font-size:32px
    color:red, // => color:rgb(255,0,0) 
}
```   
+ 计算样式，在这个阶段会进行样式继承，就是子样式的某些属性会继承父样式，最常见的属性是**font-xxx**，而计算样式则



3. ****


